## 服务管理

### 一、介绍

==服务（service）==本质就是进程，但是是运行在后台的，通常都会监听某个端口，等待其它程序的请求。

比如 mysqld、sshd、防火墙等

因此又称为 ==守护进程==，这是 Linux 中非常重要的知识点

![1651216262351](服务管理.assets/1651216262351.png)



### 二、service 指令

> 指令

```bash
service 服务名 [ start | stop | restart | reload | status ]
```



> 说明

- 在 CentOS 7.0 后，很多服务不再使用 `service`，而是 `systemctl`

- `service` 指令管理的服务在 ==/etc/init.d== 查看

  ```bash
  [root@wndexx ~]# ls -l /etc/init.d/
  总用量 84
  -rw-r--r--. 1 root root 18281 8月  24 2018 functions
  -rwxr-xr-x. 1 root root  4569 8月  24 2018 netconsole
  -rwxr-xr-x. 1 root root  7923 8月  24 2018 network
  -rw-r--r--. 1 root root  1160 10月 31 2018 README
  -rwxr-xr-x. 1 root root 44969 4月  23 15:25 vmware-tools
  ```

  



> service 管理指令案例

```bash
# 使用 service 指令查看、关闭、启动 network【注意：在虚拟系统演示，因为网络连接会关闭】
[root@wndexx ~]# service network status
已配置设备：
lo ens33
当前活跃设备：
lo ens33 virbr0
[root@wndexx ~]# service network stop
Stopping network (via systemctl):                          [  确定  ]
[root@wndexx ~]# service network start
Starting network (via systemctl):                          [  确定  ]
[root@wndexx ~]# 
```





### 三、查看服务名

> 查看所有的系统服务

```bash
# 查看所有的系统服务
setup
```

![1651223311272](服务管理.assets/1651223311272.png)



![1651223410495](服务管理.assets/1651223410495.png)



![1651223649778](服务管理.assets/1651223649778.png)



![1651223745964](服务管理.assets/1651223745964.png)



> 查看 service 指令管理的服务

```bash
ls -l /etc/init.d/
```





### 四、服务的运行级别（runlevel）

> Linux 系统有 7 种运行级别（runlevel）:常用的是级别 3 和 5

| 运行级别      | 说明                                                         |
| ------------- | ------------------------------------------------------------ |
| 运行级别 0    | 系统停机状态，系统默认运行级别不能设为 0，否则不能正常启动   |
| 运行级别1     | 单用户工作状态，root 权限，用于系统维护，禁止远程登陆        |
| 运行级别2     | 多用户状态（没有 NFS，网络文件系统），不支持网络             |
| ==运行级别3== | 完全的多用户状态（有 NFS），无界面，登录后进入控制台命令行模式 |
| 运行级别4     | 系统未使用，保留                                             |
| ==运行级别5== | X11 控制台，登录后进入图形 GUI 模式                          |
| 运行级别6     | 系统正常关闭并重启，默认运行级别不能设为 6，否则不能正常启动 |



> 开机的流程说明

![1651226092275](服务管理.assets/1651226092275.png)

> CentOS 7 后运行级别说明

在 /etc/initab 进行了简化，如下：

```bash
# multi-user.target:analogous to runlevel 3

# graphical.target:analogous to runlevel 5

# to view current default target,run
systemctl get-default

# to set a default target,run:
systemctl set-default multi-user.target
# or
systemctl set-default raphical.target
```



### 五、chkconfig 指令

> 介绍

- 通过 `chkconfig` 命令可以==设置服务在各个运行级别是否自启动==
- `chkconfig` 指令管理的服务在 /etc/init.d 查看
- 注意：CentOS 7.0 后，很多服务使用 `systemctl` 管理



> chkconfig 基本语法

```bash
# 查看 chkconfig 指令管理的服务
chkconfig --list

# 查看指定的服务
chkconfig --list | grep 服务名
# 或
chkconfig 服务名 --list 

# 设置服务在指定运行级别下是否自启动。n 是数字，代表运行级别，on 表示自启动，off 表示不自启动
chkconfig --level n 服务名 on/off
```



> 案例演示

```bash
# 设置 network 服务在运行级别 3，关闭自启动
chkconfig --level 3 network off
chkconfig --level 3 network on
```



> 使用细节

`chkconfig` 重新设置服务自启动或关闭自启动后，需要重启机器 `reboot` 生效



### 六、systemctl 指令































