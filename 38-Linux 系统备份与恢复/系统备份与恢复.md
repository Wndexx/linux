## 系统备份与恢复

实体机无法做快照，如果系统出现异常或者数据损坏，后果严重，要重做系统，还会造成数据丢失，可以使用备份和恢复技术

linux 的备份和恢复有两种方式：

- 把需要的文件（或者分区）用 `tar` 打包就行，下次需要恢复的时候，再解压覆盖即可
- 使用 `dump` 和 `restore` 命令



### 一、安装 dump 和 restore

如果 linux 上没有 `dump` 和 `restore` 指令，需要安装

```bash
yum -y install dump
yum -y install restore
```





### 二、使用 dump 完成备份

#### 2.1 基本介绍

dump 支持分卷和增量备份（所谓==增量备份==是指备份上次备份后，修改/增加过的文件，也称==差异备份==）



#### 2.2 语法说明

```bash
dump [-cu] [-0123456789] [-f <备份后文件名>] [-T <日期>] [目录或文件系统]
dump [-w/-W]
```



#### 2.3 选项说明

```bash
# 修改备份磁带预设的密度与容量
-c	

# 备份的层级。0 为最完整备份，会备份所有文件；若指定 0 以上的层级，则备份上一次备份以来修改或新增的文件，到 9 后，可以再次轮替
-0123456789	

# 指定备份后文件名
-f <备份后文件名>

# 调用 bzlib 库压缩备份文件，也就是将备份后的文件压缩成 bz2 格式，让文件更小
-j

# 指定开始备份的时间与日期
-T <日期>

# 备份完成后，在 /etc/dumpdates 中记录备份的文件系统，层级，日期与时间等。如果需要进行增量备份，这个选项不能省略 
-u 

# 指定文件名，若该文件已存在备份文件中，则列出备份文件的名称
-t 

# 显示需要备份的文件及其最后一次备份的层级，时间，日期
-W

# 与 -W 类似，但仅显示需要备份的文件
-w
```



![1651757017295](系统备份与恢复.assets/1651757017295.png)



说明：==增量备份只会备份到层级 9，继续往下备份时，又会从层级 0 开始，先进行完整备份，再从层级 1 开始进行增量备份==





#### 2.4 案例

> dump 应用案例 1

```bash
# 将 /boot 分区所有内容备份到 /opt/boot.bak0.bz2 文件中，备份级别为 "0"
dump -0uj -f /opt/boot.bak0.bz2 /boot
```



```bash
[root@wndexx etc]# dump -0uj -f /opt/boot.bak0.bz2 /boot/
  DUMP: Date of this level 0 dump: Thu May  5 22:10:18 2022
  DUMP: Dumping /dev/sda1 (/boot) to /opt/boot.bak0.bz2
  DUMP: Label: none
  DUMP: Writing 10 Kilobyte records
  DUMP: Compressing output at compression level 2 (bzlib)
  DUMP: mapping (Pass I) [regular files]
  DUMP: mapping (Pass II) [directories]
  DUMP: estimated 173541 blocks.
  DUMP: Volume 1 started with block 1 at: Thu May  5 22:10:18 2022
  DUMP: dumping (Pass III) [directories]
  DUMP: dumping (Pass IV) [regular files]
  DUMP: Closing /opt/boot.bak0.bz2
  DUMP: Volume 1 completed at: Thu May  5 22:10:45 2022
  DUMP: Volume 1 took 0:00:27
  DUMP: Volume 1 transfer rate: 5782 kB/s
  DUMP: Volume 1 174160kB uncompressed, 156136kB compressed, 1.116:1
  DUMP: 174160 blocks (170.08MB) on 1 volume(s)
  DUMP: finished in 27 seconds, throughput 6450 kBytes/sec
  DUMP: Date of this level 0 dump: Thu May  5 22:10:18 2022
  DUMP: Date this dump completed:  Thu May  5 22:10:45 2022
  DUMP: Average transfer rate: 5782 kB/s
  DUMP: Wrote 174160kB uncompressed, 156136kB compressed, 1.116:1
  DUMP: DUMP IS DONE

```





> dump 应用案例 2

























































